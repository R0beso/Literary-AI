---
import Article from "../../components/Article.astro";
import Banner from "../../components/Banner.astro";
import Home from "../../components/Home.astro";
import Layout from "../../layouts/Layout.astro";

---

<style>
    .main-article {
        max-width: 900px;
        justify-content: center;
        margin: 0.5rem auto auto auto;
    }
</style>

<Layout>
    <script>
        import arrayJson from '../../../public/api/articles.json'
        
        const idSearched = new URL(window.location.href).searchParams.get('a');
        let versionSearched = (new URL(window.location.href).searchParams.get('v') || -1).toString();
  
        // Buscar el objeto con el id deseado
        const articleData = arrayJson.find(obj => obj.id === idSearched);
        
        if (articleData && versionSearched === "-1") {
            versionSearched = articleData["versions"].length.toString();
        }

        const metaTag = document.querySelector('meta[name="description"]');

        if (metaTag) {
            if (document.documentElement.lang === "es") {
                metaTag.setAttribute('content', articleData?.['versions'][parseInt(versionSearched)-1]['summary-es'] || "Descubre contenido resumido y perspicaz generado por IA, que abarca temas desde tecnología hasta estilo de vida. Mantente informado con resúmenes concisos e inteligentes.");
            } else {
                metaTag.setAttribute('content', articleData?.['versions'][parseInt(versionSearched)-1]['summary-en'] || "Discover summarized and insightful content generated by AI, covering topics from technology to lifestyle. Stay informed with concise, intelligent overviews.");
            }
        }

        function defineTitle() {
            let title;

            if (document.documentElement.lang === "en") title = articleData?.['title-en'];
            else title = articleData?.['title-es'];
            
            const metaTag = document.querySelector('title');
            if (metaTag) metaTag.textContent = title || "Hippobese";
        }

        defineTitle();
        const clickDiv = document.querySelector('.flags');

        if (clickDiv) {
            clickDiv.addEventListener('click', () => {
                defineTitle();
            });
        }
    </script>

    <div class="main-article">
        <Banner />
        <Article />
    </div>

    <hr style="border: none; border-top: 1px solid #272727;" />
    <hr style="border: none; border-top: 1px solid #272727;" />

    <Home homeNative={false}/>

</Layout>